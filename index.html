<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"
/>
<title>Selective Precipitation Simulator</title>
<style>
:root{
  --bg:#ffffff; --panel:#f8f9fa; --ink:#000000; --muted:#6c757d;
  --blue:#0066cc; --green:#00aa44; --red:#dc3545;
  --border:#333333; --grey:#808080;
  --design-width:1100px;
}

html, body { overflow-x: hidden; }
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);color:var(--ink);
}

/* ---- Scaler: makes the entire UI smaller on phones, preserving proportions ---- */
#scaler{
  transform-origin: top center;
  width: var(--design-width);
  margin: 0 auto;
  /* height is set via JS to reserve layout space equal to the scaled content */
}
#stage{
  width: var(--design-width);
  margin: 0 auto;
}

/* -------- ORIGINAL STYLES (unchanged) -------- */
header{text-align:center;padding:24px 20px 8px;
  background:linear-gradient(to bottom,#e8f4f8,#ffffff);
  border-bottom:4px solid var(--border);}
header h1{margin:0;font-weight:800}
header p{margin:.35rem 0 0;font-size:1.05rem}
header .chem-eqn{margin-top:.4rem}

.wrap{
  max-width:1100px;margin:16px auto;padding:0 16px 24px;
  display:grid;grid-template-columns:420px 1fr;gap:18px;
}

.card{
  background:var(--panel);border:4px solid var(--border);border-radius:18px;
  padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);
}
.pill{
  display:inline-flex;align-items:center;gap:.4rem;background:#e6f2ff;
  border:2px solid var(--blue);color:var(--blue);
  padding:.3rem .6rem;border-radius:999px;font-weight:600;
}
input[type=range]{width:100%;accent-color:var(--blue);}

.toggle{display:flex;align-items:center;gap:.5rem;font-weight:700;margin-bottom:8px;}
.toggle input{accent-color:var(--blue);}

.beaker{
  --w:210px;width:var(--w);height:220px;border:4px solid var(--blue);
  border-bottom-left-radius:12px;border-bottom-right-radius:12px;
  position:relative;margin:8px auto;
  background:linear-gradient(to bottom,#e6f7ff,#cceeff);
}
.precip{
  position:absolute;bottom:10px;left:50%;transform:translateX(-50%);
  background:#fff;border:2px solid var(--red);
  border-radius:14px 14px 8px 8px/18px 18px 10px 10px;
  display:none;width:10px;height:6px;transition:all .25s ease-in-out;
  box-shadow:0 0 8px rgba(220,53,69,.25), 0 2px 0 rgba(0,0,0,.06) inset;
}
.precip.show{display:block}
.ppt-label{
  position:absolute;left:50%;transform:translateX(-50%);
  display:none;align-items:center;font-size:.9rem;
  color:var(--red);font-weight:700;pointer-events:none;
  transition:opacity .25s ease-in-out;
}
.ppt-label.show{display:flex;opacity:1}

/* small helper for beaker labels (from your original) */
.b-labels{position:absolute;top:8px;left:50%;transform:translateX(-50%);
  text-align:center;font-weight:600;color:#000;}

/* Tracker */
.tracker{margin-top:8px;padding:12px;background:#fff;border:2px solid var(--border);border-radius:8px;}
.grid{display:grid;grid-template-columns:1fr max-content;row-gap:6px;column-gap:10px;align-items:center;}
.val{padding:.2rem .45rem;border:2px solid var(--muted);border-radius:8px;min-width:8.8ch;text-align:right;font-weight:600;}
.sat.ok{background:#d4f4dd;border:2px solid var(--green);color:var(--green);}
.sat.bad{background:#ffeeee;border:2px solid var(--red);color:var(--red);}
.ip-ok{background:#d4f4dd;border:2px solid var(--green);color:var(--green);}
.ip-bad{background:#ffeeee;border:2px solid var(--red);color:var(--red);}

/* Bars */
.bars-wrap{padding:12px;background:#fff;border:2px solid var(--border);border-radius:8px;}
.bar-headline{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  font-weight:700;margin-bottom:6px;min-height:1.4em;
}
.bar-headline .left{white-space:nowrap;}
.bar-headline .right{white-space:nowrap;}
.bar-headline .red{color:var(--red);}

.bars{
  height:360px;display:grid;grid-template-columns:repeat(3,1fr);
  align-items:end;gap:20px;
}
.bar{
  width:60%;justify-self:center;border-radius:12px 12px 0 0;
  position:relative;box-shadow:0 2px 8px rgba(0,0,0,.15);border:2px solid;
}
.bar small{
  position:absolute;top:-22px;left:50%;transform:translateX(-50%);
  font-weight:600;white-space:nowrap;
}
#barCa{background:rgba(0,102,204,0.2);border-color:var(--blue);}
#barSO4{background:rgba(0,170,68,0.2);border-color:var(--green);}
#barConstCa{background:rgba(128,128,128,0.3);border-color:var(--grey);}

.bar-labels{
  display:grid;grid-template-columns:repeat(3,1fr);
  justify-items:center;text-align:center;margin-top:8px;
  font-weight:700;font-size:1.15rem;letter-spacing:.1px;
}

/* No media overrides—scaling handles responsiveness to preserve proportions */
</style>
</head>
<body>
<div id="scaler">
  <div id="stage">
    <header>
      <h1>• Selective Precipitation Simulator •</h1>
      <p>What happens when solid Na₂SO₄ is added to a solution containing both Ca²⁺ and Hg²⁺?</p>
      <p class="chem-eqn">Ca²⁺(aq) + SO₄²⁻(aq) ⇌ CaSO₄(s); K<sub>sp</sub> = 5.0 × 10⁻⁵</p>
      <p class="chem-eqn">Hg²⁺(aq) + SO₄²⁻(aq) ⇌ HgSO₄(s); K<sub>sp</sub> = 6.8 × 10⁻⁵</p>
    </header>

    <div class="wrap">
      <section class="card">
        <h3>Add Na₂SO₄(s)</h3>
        <div class="slider-block">
          <div class="pill"><b id="nAdded">0.000</b> mol</div>
          <input id="stepSlider" type="range" min="0" max="20" step="1" value="0"/>
        </div>

        <div class="beaker">
          <div class="b-labels">vol = 1 dm³<br>initial n Ca²⁺ = 0.010 mol<br>initial n Hg²⁺ = 0.005 mol</div>
          <div id="precip" class="precip"></div>
          <div id="pptLabel" class="ppt-label">CaSO₄(s)</div>
        </div>

        <div class="tracker">
          <div class="grid">
            <div><b>n Ca²⁺(aq)</b></div><div class="val" id="nCa">0.01000</div>
            <div><b>n SO₄²⁻(aq)</b></div><div class="val" id="nSulf">0.00000</div>
            <div><b>IP : [Ca²⁺][SO₄²⁻]</b></div><div class="val ip-ok" id="ipCa">0.00000</div>
            <div><b>n CaSO₄(s)</b></div><div class="val" id="nSolid">0.00000</div>
            <div><b>status (CaSO₄)</b></div><div class="sat ok" id="satCa">not saturated</div>
          </div>
          <hr>
          <div class="grid">
            <div><b>n Hg²⁺(aq)</b></div><div class="val" id="nHg">0.00500</div>
            <div><b>IP : [Hg²⁺][SO₄²⁻]</b></div><div class="val ip-ok" id="ipHg">0.00000</div>
            <div><b>status (HgSO₄)</b></div><div class="sat ok" id="satHg">not saturated</div>
          </div>
        </div>
      </section>

      <section class="card">
        <label class="toggle"><input id="showBars" type="checkbox" checked> Show bar graph</label>

        <div id="barsWrap" class="bars-wrap">
          <div class="bar-headline">
            <span id="noteCa" class="left"></span>
            <span id="noteHg" class="right"></span>
          </div>

          <div class="bars">
            <div class="bar" id="barCa"><small id="barCaVal">0.01000 mol</small></div>
            <div class="bar" id="barSO4"><small id="barSO4Val">0.00000 mol</small></div>
            <div class="bar" id="barConstCa"><small id="barConstCaVal">0.00500 mol</small></div>
          </div>

          <div class="bar-labels">
            <div style="color:var(--blue)">n Ca²⁺(aq)</div>
            <div style="color:var(--green)">n SO₄²⁻(aq)</div>
            <div style="color:var(--grey)">n Hg²⁺(aq)</div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<script>
/* ---------- SCALE-TO-FIT (keeps proportions identical) ---------- */
(function(){
  const DESIGN = 1100; // px (matches CSS --design-width)
  const scaler = document.getElementById('scaler');
  const stage  = document.getElementById('stage');

  function rescale(){
    const viewportW = Math.max(320, window.innerWidth || document.documentElement.clientWidth || 320);
    const pad = 16; // breathing room so content never touches edges
    const raw = (viewportW - pad) / DESIGN;
    const scale = Math.max(0.1, Math.min(1, raw)); // clamp to [0.1, 1]

    // Apply scale and reserve the correct space
    scaler.style.transform = 'scale(' + scale + ')';

    // Use requestAnimationFrame to ensure height after layout
    window.requestAnimationFrame(() => {
      const unscaledH = stage.offsetHeight; // true, unscaled height
      scaler.style.height = (unscaledH * scale) + 'px';
    });
  }

  // Recalculate after load and on any viewport change
  window.addEventListener('load', rescale, { passive: true });
  window.addEventListener('resize', rescale, { passive: true });
  window.addEventListener('orientationchange', rescale, { passive: true });

  // In case fonts load later and change height
  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(rescale);
  }
})();

/* ---------- ORIGINAL APP LOGIC (unchanged) ---------- */
const DATA = [
  {added:0.000,nCa:0.01000,nSO4:0.00000,nSolid:0.00000,ip:0.00000,sat:false,nHg:0.00500,ipHg:0.000000,satHg:false},
  {added:0.001,nCa:0.01000,nSO4:0.00100,nSolid:0.00000,ip:0.00001,sat:false,nHg:0.00500,ipHg:0.000005,satHg:false},
  {added:0.002,nCa:0.01000,nSO4:0.00200,nSolid:0.00000,ip:0.00002,sat:false,nHg:0.00500,ipHg:0.000010,satHg:false},
  {added:0.003,nCa:0.01000,nSO4:0.00300,nSolid:0.00000,ip:0.00003,sat:false,nHg:0.00500,ipHg:0.000015,satHg:false},
  {added:0.004,nCa:0.01000,nSO4:0.00400,nSolid:0.00000,ip:0.00004,sat:false,nHg:0.00500,ipHg:0.000020,satHg:false},
  {added:0.005,nCa:0.01000,nSO4:0.00500,nSolid:0.00000,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000025,satHg:false},
  {added:0.006,nCa:0.00935,nSO4:0.00535,nSolid:0.00065,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000027,satHg:false},
  {added:0.007,nCa:0.00873,nSO4:0.00573,nSolid:0.00127,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000029,satHg:false},
  {added:0.008,nCa:0.00814,nSO4:0.00614,nSolid:0.00186,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000031,satHg:false},
  {added:0.009,nCa:0.00759,nSO4:0.00659,nSolid:0.00241,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000033,satHg:false},
  {added:0.010,nCa:0.00707,nSO4:0.00707,nSolid:0.00293,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000035,satHg:false},
  {added:0.011,nCa:0.00659,nSO4:0.00759,nSolid:0.00341,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000038,satHg:false},
  {added:0.012,nCa:0.00614,nSO4:0.00814,nSolid:0.00386,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000041,satHg:false},
  {added:0.013,nCa:0.00573,nSO4:0.00873,nSolid:0.00427,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000044,satHg:false},
  {added:0.014,nCa:0.00535,nSO4:0.00935,nSolid:0.00465,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000047,satHg:false},
  {added:0.015,nCa:0.00500,nSO4:0.01000,nSolid:0.00500,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000050,satHg:false},
  {added:0.016,nCa:0.00468,nSO4:0.01068,nSolid:0.00532,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000053,satHg:false},
  {added:0.017,nCa:0.00439,nSO4:0.01139,nSolid:0.00561,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000057,satHg:false},
  {added:0.018,nCa:0.00412,nSO4:0.01212,nSolid:0.00588,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000061,satHg:false},
  {added:0.019,nCa:0.00388,nSO4:0.01288,nSolid:0.00612,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000064,satHg:false},
  {added:0.020,nCa:0.00366,nSO4:0.01366,nSolid:0.00634,ip:0.00005,sat:true ,nHg:0.00500,ipHg:0.000068,satHg:true}
];

const nAdded=document.getElementById('nAdded');
const nCa=document.getElementById('nCa');
const nSulf=document.getElementById('nSulf');
const nSolid=document.getElementById('nSolid');
const ipCa=document.getElementById('ipCa');
const satCa=document.getElementById('satCa');
const nHg=document.getElementById('nHg');
const ipHg=document.getElementById('ipHg');
const satHg=document.getElementById('satHg');
const precip=document.getElementById('precip');
const pptLabel=document.getElementById('pptLabel');

const barCa=document.getElementById('barCa');
const barSO4=document.getElementById('barSO4');
const barConstCa=document.getElementById('barConstCa');
const barCaVal=document.getElementById('barCaVal');
const barSO4Val=document.getElementById('barSO4Val');
const barConstCaVal=document.getElementById('barConstCaVal');

const noteCa=document.getElementById('noteCa');
const noteHg=document.getElementById('noteHg');

const barsWrap=document.getElementById('barsWrap');
const showBars=document.getElementById('showBars');

const stepSlider=document.getElementById('stepSlider');

const GLOBAL_MAX=Math.max(...DATA.map(d=>Math.max(d.nCa,d.nSO4,d.nSolid)));
const MAX_SOLID=Math.max(...DATA.map(d=>d.nSolid));

function setBars(v1,v2){
  const scale=x=>Math.max(4,(x/GLOBAL_MAX)*100);
  const constHg=0.00500;
  barCa.style.height=scale(v1)+'%';
  barSO4.style.height=scale(v2)+'%';
  barConstCa.style.height=scale(constHg)+'%';
  barCaVal.textContent=v1.toFixed(5) + ' mol';
  barSO4Val.textContent=v2.toFixed(5) + ' mol';
  barConstCaVal.textContent=constHg.toFixed(5) + ' mol';
}

function setPrecipitate(nSolid){
  const frac = Math.max(0, Math.min(1, nSolid / MAX_SOLID));
  if (frac > 0.00001){
    const width = 28 + frac * 120;
    const height = 10 + frac * 52;
    precip.style.width = width + 'px';
    precip.style.height = height + 'px';
    precip.classList.add('show');

    const labelBottom = 10 + height + 8;
    pptLabel.style.bottom = labelBottom + 'px';
    pptLabel.classList.add('show');
  }else{
    precip.classList.remove('show');
    pptLabel.classList.remove('show');
  }
}

function setNotes(added){
  noteCa.textContent = '';
  noteHg.textContent = '';
  noteCa.className = 'left';
  noteHg.className = 'right';

  const EPS = 1e-12;

  if (added <= 0.004 + EPS){
    noteCa.textContent = '[Ca²⁺][SO₄²⁻] < 5.0 × 10⁻⁵';
  } else if (added >= 0.005 - EPS && added <= 0.020 + EPS){
    noteCa.textContent = '[Ca²⁺][SO₄²⁻] = 5.0 × 10⁻⁵';
    noteCa.classList.add('red');
  }

  if (added <= 0.019 + EPS){
    noteHg.textContent = '[Hg²⁺][SO₄²⁻] < 6.8 × 10⁻⁵';
  }
  if (Math.abs(added - 0.020) <= EPS){
    noteHg.textContent = '[Hg²⁺][SO₄²⁻] = 6.8 × 10⁻⁵';
    noteHg.classList.add('red');
  }
}

function apply(idx){
  const d=DATA[idx];
  nAdded.textContent=d.added.toFixed(3);
  nCa.textContent=d.nCa.toFixed(5);
  nSulf.textContent=d.nSO4.toFixed(5);
  nSolid.textContent=d.nSolid.toFixed(5);
  ipCa.textContent=d.ip.toFixed(5);
  nHg.textContent=d.nHg.toFixed(5);
  ipHg.textContent=d.ipHg.toFixed(6);

  ipCa.className=d.sat?'val ip-bad':'val ip-ok';
  satCa.className=d.sat?'sat bad':'sat ok';
  satCa.textContent=d.sat?'saturated':'not saturated';
  ipHg.className=d.satHg?'val ip-bad':'val ip-ok';
  satHg.className=d.satHg?'sat bad':'sat ok';
  satHg.textContent=d.satHg?'saturated':'not saturated';

  setPrecipitate(d.nSolid);
  setBars(d.nCa,d.nSO4);
  setNotes(d.added);
}

showBars.addEventListener('change', e=>{
  barsWrap.style.display = e.target.checked ? 'block' : 'none';
});

stepSlider.addEventListener('input', e=>apply(+e.target.value));
apply(0);
</script>
</body>
</html>
